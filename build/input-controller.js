(function (name, definition, global) {if (typeof define === 'function') {define(definition);} else if (typeof module !== 'undefined' && module.exports) {module.exports = definition();} else {global[name] = definition();}})('inputController', function () {'use strict';var module$src$InputController={},InputController$$module$src$InputController=function(a){this.deviceHandlers={};this.bindings={};this.input={};a&&this.setupBindings(a)};
InputController$$module$src$InputController.prototype={bindings:null,deviceHandlers:null,input:null,setupBindings:function(a){Object.keys(a).forEach(function(b){var c=a[b],d={}.toString;this.input[b]=0;if("[object Array]"==d.call(c))for(var d=0,e=c.length;d<e;d++)this._applyBinding(c[d],b);else this._applyBinding(c,b)},this)},updateBindings:function(a){this.setupBindings(a);Object.keys(this.deviceHandlers).forEach(function(a){this.deviceHandlers[a].bindings=this.bindings[a]||{};this.deviceHandlers[a].input=
this.input},this)},_applyBinding:function(a,b){this.bindings[a.device]||(this.bindings[a.device]={});this.bindings[a.device][a.inputId]={description:b,down:!!a.down,up:!!a.up,invert:!!a.invert}},registerDeviceHandler:function(a,b){this.deviceHandlers[b]=new a(this.bindings[b]||{},this.input)},destroy:function(){Object.keys(this.deviceHandlers).forEach(function(a){this.deviceHandlers[a].destroy()},this)},startDetecting:function(a){var b=function(b){b.timestamp=Date.now();a(b)};Object.keys(this.deviceHandlers).forEach(function(a){a=
this.deviceHandlers[a];a._detectCallback=b;a.isDetecting=!0},this)},stopDetecting:function(){Object.keys(this.deviceHandlers).forEach(function(a){a=this.deviceHandlers[a];a._detectCallback=null;a.isDetecting=!1},this)}};module$src$InputController.module$exports=InputController$$module$src$InputController;module$src$InputController.module$exports&&(module$src$InputController=module$src$InputController.module$exports);var module$src$KeyboardHandler={},KeyboardHandler$$module$src$KeyboardHandler=function(a,b){this.bindings=a;this.input=b;document.addEventListener("keyup",this.upListener=this.onKeyUp.bind(this),!1);document.addEventListener("keydown",this.downListener=this.onKeyDown.bind(this),!1)};
KeyboardHandler$$module$src$KeyboardHandler.prototype={isDetecting:!1,onKeyDown:function(a){this.isDetecting?this._detectCallback({device:"keyboard",inputId:a.keyCode,isAxis:!1}):a.keyCode in this.bindings&&(a=this.bindings[a.keyCode],a.down&&(this.input[a.description]=1))},onKeyUp:function(a){!this.isDetecting&&a.keyCode in this.bindings&&(a=this.bindings[a.keyCode],a.up&&(this.input[a.description]=0))},destroy:function(){document.removeEventListener("keyup",this.upListener,!1);document.removeEventListener("keydown",
this.downListener,!1)}};module$src$KeyboardHandler.module$exports=KeyboardHandler$$module$src$KeyboardHandler;module$src$KeyboardHandler.module$exports&&(module$src$KeyboardHandler=module$src$KeyboardHandler.module$exports);var module$src$MouseHandler={},MouseHandler$$module$src$MouseHandler=function(a,b){this.bindings=a;this.input=b;this.input.mouseX=0;this.input.mouseY=0;var c=!1,d=null;["webkitPointerLockElement","mozPointerLockElement","pointerLockElement"].forEach(function(a){a in document&&(c=!0,d=a)},this);this.hasPointerLockSupport=c;this.pointerLockElementProperty=d;document.addEventListener("mousemove",this.moveListener=this.onMouseMove.bind(this),!1);document.addEventListener("mousedown",this.downListener=
this.onMouseDown.bind(this),!1);document.addEventListener("mouseup",this.upListener=this.onMouseUp.bind(this),!1);document.addEventListener("contextmenu",(this.ctxListener=function(a){a.preventDefault()}).bind(this),!1);window.addEventListener("resize",this.resizeListener=this.onResize.bind(this),!1);this.onResize()};
MouseHandler$$module$src$MouseHandler.prototype={hasPointerLockSupport:!1,pointerLockElementProperty:null,movementProperty:"",infiniteXAxis:!1,infiniteYAxis:!1,width:0,height:0,onMouseMove:function(a){var b,c,d,e;d=this.width;b=d/2;e=this.height;c=e/2;var f=this.hasPointerLockSupport&&null!==document[this.pointerLockElementProperty];this._initialized||(["webkitMovement","mozMovement","movement"].forEach(function(b){b+"X"in a&&(this.movementProperty=b)},this),this.input.mouseX=a.pageX-(f?a[this.movementProperty+
"X"]:0),this.input.mouseY=a.pageY-(f?a[this.movementProperty+"Y"]:0),this._initialized=!0);var g=a[this.movementProperty+"X"],h=a[this.movementProperty+"Y"];f?(d=this.clamp(0,d,this.input.mouseX+g),e=this.clamp(0,e,this.input.mouseY+h)):(d=a.pageX,e=a.pageY);b=this.infiniteXAxis?f?g:d-this.input.mouseX:-(d-b)/b;c=this.infiniteYAxis?f?h:e-this.input.mouseY:-(e-c)/c;this.isDetecting?(d=Math.abs(this.input.mouseX-d),e=Math.abs(this.input.mouseY-e),this._detectCallback({device:"mouse",inputId:d>e?"x":
"y",isAxis:!0})):(this.input.mouseX=d,this.input.mouseY=e,"x"in this.bindings&&(d=this.bindings.x,this.input[d.description]=d.invert?-1*b:b),"y"in this.bindings&&(d=this.bindings.y,this.input[d.description]=d.invert?-1*c:c))},onMouseDown:function(a){this.isDetecting?this._detectCallback({device:"mouse",inputId:a.button,isAxis:!1}):a.button in this.bindings&&(a=this.bindings[a.button],a.down&&(this.input[a.description]=1))},onMouseUp:function(a){!this.isDetecting&&a.button in this.bindings&&(a=this.bindings[a.button],
a.up&&(this.input[a.description]=0))},onResize:function(){this.width=window.innerWidth;this.height=window.innerHeight},clamp:function(a,b,c){return Math.min(b,Math.max(a,c))},destroy:function(){document.removeEventListener("mousemove",this.moveListener,!1);document.removeEventListener("mousedown",this.downListener,!1);document.removeEventListener("mouseup",this.upListener,!1);document.removeEventListener("contextmenu",this.ctxListener,!1);window.removeEventListener("resize",this.resizeListener,!1)}};
module$src$MouseHandler.module$exports=MouseHandler$$module$src$MouseHandler;module$src$MouseHandler.module$exports&&(module$src$MouseHandler=module$src$MouseHandler.module$exports);var module$src$GamepadHandler={},GamepadHandler$$module$src$GamepadHandler=function(a,b){this.bindings=a;this.input=b;this.gamepads=[];this.prevRawGamepadTypes=[];this.prevTimestamps=[];this.buttonStates=[];this.axisValues=[];this.init()};
GamepadHandler$$module$src$GamepadHandler.prototype={deadzone:0.01,buttonStates:null,axisValues:null,gamepads:null,isPolling:!1,prevRawGamepadTypes:null,prevTimestamps:null,init:function(){if(navigator.webkitGetGamepads||navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/"))window.addEventListener("MozGamepadConnected",this.connectListener=this.onGamepadConnect.bind(this),!1),window.addEventListener("MozGamepadDisconnected",this.disconnectListener=this.onGamepadDisconnect.bind(this),
!1),(navigator.webkitGamepads||navigator.webkitGetGamepads)&&this.startPolling()},onGamepadConnect:function(a){this.gamepads.push(a.gamepad);this.startPolling()},onGamepadDisconnect:function(a){for(var b=this.gamepads-1;0<=b;b--)if(this.gamepads[b].index==a.gamepad.index){this.gamepads.splice(b,1);break}0===this.gamepads.length&&this.stopPolling()},startPolling:function(){this.isPolling||(this.isPolling=!0,this.tick())},stopPolling:function(){this.isPolling=!1},tick:function(){if(this.isPolling){var a=
this.tick.bind(this);window.requestAnimationFrame?window.requestAnimationFrame(a):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(a):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(a)}this.pollStatus()},pollStatus:function(){this.pollGamepads();for(var a=0,b=this.gamepads.length;a<b;a++){var c=this.gamepads[a];c.timestamp&&c.timestamp==this.prevTimestamps[a]||(this.prevTimestamps[a]=c.timestamp,this.onStatusChanged(a))}},pollGamepads:function(){var a=navigator.webkitGetGamepads&&
navigator.webkitGetGamepads()||navigator.webkitGamepads,b,c;if(a){this.gamepads.length=0;var d=!1;b=0;for(c=a.length;b<c;b++)typeof a[b]!=this.prevRawGamepadTypes[b]&&(d=!0,this.prevRawGamepadTypes[b]=typeof a[b]),a[b]&&this.gamepads.push(a[b]);if(d)for(this.buttonStates.length=0,b=this.axisValues.length=0,c=this.gamepads.length;b<c;b++){var a=this.gamepads[b],e=this.buttonStates[b]=[];a.buttons.forEach(function(a,b){e[b]=a},this);var f=this.axisValues[b]=[];a.axes.forEach(function(a,b){f[b]=Math.abs(a)>
this.deadzone?a:0},this)}}},onStatusChanged:function(a){var b=this.gamepads[a],c=this.buttonStates[a];a=this.axisValues[a];var d,e,f;d=0;for(e=b.buttons.length;d<e;d++){var g=b.buttons[d],h=c[d];f="button-"+d;h!=g&&(this.isDetecting?this._detectCallback({device:"gamepad",inputId:f,isAxis:!1}):(h=g>h?"down":"up",f in this.bindings&&(f=this.bindings[f],f[h]&&(this.input[f.description]=g))),c[d]=g)}d=0;for(e=b.axes.length;d<e;d++)c=b.axes[d],Math.abs(c)<=this.deadzone&&(c=0),g="axis-"+d,this.isDetecting&&
a[d]!=c?this._detectCallback({device:"gamepad",inputId:g,isAxis:!0}):g in this.bindings&&(f=this.bindings[g],f.invert&&(c*=-1),this.input[f.description]=c),a[d]=c},destroy:function(){window.removeEventListener("MozGamepadConnected",this.connectListener,!1);window.removeEventListener("MozGamepadDisconnected",this.disconnectListener,!1)}};module$src$GamepadHandler.module$exports=GamepadHandler$$module$src$GamepadHandler;module$src$GamepadHandler.module$exports&&(module$src$GamepadHandler=module$src$GamepadHandler.module$exports);var module$src$SpeechHandler={},SpeechHandler$$module$src$SpeechHandler=function(a,b){this.bindings=a;this.input=b;if("webkitSpeechRecognition"in window){var c=this.recognition=new window.webkitSpeechRecognition;c.continuous=!0;c.interimResults=!0;c.onstart=this._startHandler.bind(this);c.onerror=this._errorHandler.bind(this);c.onend=this._endHandler.bind(this);c.onresult=this._resultHandler.bind(this)}};
SpeechHandler$$module$src$SpeechHandler.prototype={recognition:null,isRecognizing:!1,isActive:!1,language:"en-US",requiredConfidence:0.5,onRecognitionEnded:null,_startHandler:function(){this.isRecognizing=!0},_errorHandler:function(){this.isActive=this.isRecognizing=!1;this.onRecognitionEnded&&this.onRecognitionEnded()},_endHandler:function(){this.isActive=this.isRecognizing=!1;this.onRecognitionEnded&&this.onRecognitionEnded()},_resultHandler:function(a){if(this.isActive)for(var b=a.resultIndex;b<
a.results.length;++b){var c=a.results[b],d=c[0];if(c.isFinal||d.confidence>=this.requiredConfidence)c=d.transcript,c in this.bindings&&(this.recognition.stop(),this.input[this.bindings[c].description]=1)}},start:function(){this.isActive||(this.isRecognizing||(this.recognition.lang=this.language,this.recognition.start()),this.isActive=!0)},stop:function(){this.isActive=!1},destroy:function(){}};module$src$SpeechHandler.module$exports=SpeechHandler$$module$src$SpeechHandler;
module$src$SpeechHandler.module$exports&&(module$src$SpeechHandler=module$src$SpeechHandler.module$exports);var module$src$bundle_all={},InputController$$module$src$bundle_all=module$src$InputController,MouseHandler$$module$src$bundle_all=module$src$MouseHandler,Keyboardhandler$$module$src$bundle_all=module$src$KeyboardHandler,GamepadHandler$$module$src$bundle_all=module$src$GamepadHandler,SpeechHandler$$module$src$bundle_all=module$src$SpeechHandler,bundle$$module$src$bundle_all=new InputController$$module$src$bundle_all;
bundle$$module$src$bundle_all.registerDeviceHandler(MouseHandler$$module$src$bundle_all,"mouse");bundle$$module$src$bundle_all.registerDeviceHandler(Keyboardhandler$$module$src$bundle_all,"keyboard");bundle$$module$src$bundle_all.registerDeviceHandler(GamepadHandler$$module$src$bundle_all,"gamepad");bundle$$module$src$bundle_all.registerDeviceHandler(SpeechHandler$$module$src$bundle_all,"speechhandler");module$src$bundle_all.module$exports=bundle$$module$src$bundle_all;
module$src$bundle_all.module$exports&&(module$src$bundle_all=module$src$bundle_all.module$exports);
return module$src$bundle_all; });
